 # h3 #
 
Penetration Testing Course – ict4tn027-3001  
Haaga-Helia  
 http://terokarvinen.com/2018/penetration-testing-course-autumn-2018  
 
 1) Kokeile haavoittuvuusskanneria (vulnerability scanner). Käytä jotain muuta kuin tunnilla kokeiltua niktoa. Esim. openvas, w3af…
 
 2) Haavoittuvuusskannaa 5 konetta HackTheBoxin verkosta. Käytä kahta skanneria, esimerkiksi niktoa ja edellisessä kohdassa valitsemaasi skanneria. Analysoi tulokset. Mitkä palvelut vaikuttavat helpoimmilta kohteilta aloittaa hyökkäys? Jos haluat, voit tuoda tulokset metasploit:iin db_import -komennolla.
 
 3) Silmäile Mirai-haittaohjelman lähdekoodia. Etsi lista salasanoista, joita Mirai käyttää. (Tämän kohdan voi tehdä pelkästä lähdekoodista. Mitään ei tarvitse kääntää eikä ajaa. Binäärimuotoiset virukset ja madot voivat levitä, joten niiden käsittely vaatii erityisjärjestelyjä.)
 
 4) Yritä korkata joku kone HackTheBoxin verkosta. Maaliin asti ei tarvitse päästä, mutta raportoi mitä kokeilit ja mitä johtolankoja jäi vielä tutkittavaksi.Voit apupyörinä katsoa listasta, mitkä koneet on arvioitu helpoiksi.
 
 5) Vapaaehtoinen: Miten OWASP WebGoat:n Authentication Bypass -hyökkäys toimii? Voit lukea OWASP 10 mitä tämä hyökkäys tarkoittaa ja sitten ratkaista tehtävän WebGoatista. Lopuksi voit katsoa WebGoatin lähdekoodista “string fishing” -tekniikalla, miten koodi toimii.
 
 
# Tehtävä 1 #

1) Kokeile haavoittuvuusskanneria (vulnerability scanner). Käytä jotain muuta kuin tunnilla kokeiltua niktoa. Esim. openvas, w3af…

Tähän asti olen kokeillut pelkästään Nmap haavoittuvuusskanneria. Ajattelin ensimmäisessä tehtävässä tutustua OpenVAS:iin.

Lataus osoitteesta: http://www.openvas.org/download.html

Valitsin Virtual Appliance -linkin, josta aukeaa seuraava sivu jossa on ISO:n latauslinkki ja ohjeet.  
![kuva1](https://i.imgur.com/Y2jIQBN.png)

Käytän Virtualboxia ohjelman asennukseen, koska se löytyykin jo kätevästi entuudestaan. Ohjeet asennukseen löytyvät tämän repon kansiosta [Asennuksia](https://github.com/nauskis/Pentesting-syksy2018/blob/master/Asennuksia/Virtualbox.md).  

Virtualboxissa ei mitään uutta, valitaan New, annetaan ohjeen suosittelemat parametrit ja käynnistetään kone. Käynnistettäessä valitaan aiemmin ladattu ISO -tiedosto ja jatketaan ohjeiden seuraamista. Asennuksessa kului noin 5 minuuttia. Tämän jälkeen tulee syöttää käyttäjätunnukset pääkäyttäjälle.

Ohjeissa taisi olla jokin pieni epäselvyys, koska luotuani openVAS virtuaalikoneen, en pystynyt kirjautumaan sisään juuri luomillani tunnuksilla. Asennan kaiken alusta ja koitan uudelleen.  
Tällä kertaa luotuani pääkäyttäjän tunnukset asennusohjelma pyysi minua heti reboottaamaan koneen, toisin kuin ensimmäisellä kerralla.

Kirjauduttuani sisään uudelle virtuaalikoneelle, saan uuden promptin, jossa kehotetaan käymään asennus loppuun ja luomaan web-admin tunnukset.  
![kuva2](https://i.imgur.com/5d7DBmc.png)

Tässä törmätäänkin seuraavaan ongelmaan. Selaimeni aikakatkaistaan kun yritän yhdistää openVAS:n verkkosivuun, ja koittaessani toista [ohjetta](https://www.kali.org/penetration-testing/openvas-vulnerability-scanning/) Kalin omilta sivuilta mikään ei toimi. Vika taitaa olla Kalin asennuksessa.  
![kuva3](https://i.imgur.com/YlyWkNr.jpg)

Aloin tutkia miksi apt-get komennoissa on ongelmia. Löysin seuraavanlaisen [ohjeen](https://unix.stackexchange.com/questions/373362/apt-get-not-working-on-my-kali-linux), jonka jälkeen pystyin asentamaan ohjelmia komentoriviltä. Kokeillaan uudelleen Kalin openVAS -ohjetta.  
```
apt-get update  
apt-get dist-upgrade     #Ei välttämättä tarpeellinen. Pyörii melko kauan.

sudo apt-get install -y openvas  
sudo openvas-setup  
```
setup eteni vähän aikaa oikein sulavasti, kunnes alkoi sylkeä ulos virheitä kovalla tahdilla.  
![kuva4](https://i.imgur.com/jYVwdlK.jpg)  
Tätä jatkui noin 15 min, jolloin keskeytin toiminnon painamalla **Ctrl + c**. Setuppi kuitenkin jatkoi tämän jälkeen itsestään loppuun asti, ja lopuksi avasi selain -ikkunan. Nyt ollaankin jo vaiheessa jossa ohjeet tulevat mukaan. Painetaan *Advanced* ja *Allow exception..*  
![kuva5](https://i.imgur.com/rxCJmla.jpg)

Kun openvas-setup lopettaa toimintansa, OpenVAS managerin, skannerin, and GSAD palveluiden tulisi olla aktiivisia. Voidaan tarkistaa komennolla `netstat -antp`.

Ohjelman käyttöliittymän selaimessa voi käynnistää komennolla `openvas-start`.

Graafisen käyttöliittymän käyttö on alkuun hieman epäselvää. *Scans --> Tasks* sivulta löytyy vasemmasta yläkulmasta *Task Wizard*, jonka avulla ensimmäiset skannaukset on helppo suorittaa avustetusti.

Ensimmäisenä skannasin valmiiksi korkatun Jerryn eli 10.10.10.95 (HackTheBox.eu harjoitusmaali). Annoin IP-osoitteen Task Wizardin hellään huomaan ja seurailin tapahtumia.  
![kuva6](https://i.imgur.com/hFjJLYk.png)

Laitin lisäksi seuraavan kohteeni, eli Poisonin, saman skannauksen kohteeksi.  
![kuva7](https://i.imgur.com/kOP2fZ0.png)  

Tämä kattaa ensimmäisen tehtävän osuuden. Aikaa meni eri kommerverkkien kanssa noin kolme tuntia, mutta onneksi jatkettiin yrittämistä ja saatiin työkalut toimimaan.

# Tehtävä 2 #  

2) Haavoittuvuusskannaa 5 konetta HackTheBoxin verkosta. Käytä kahta skanneria, esimerkiksi niktoa ja edellisessä kohdassa valitsemaasi skanneria. Analysoi tulokset. Mitkä palvelut vaikuttavat helpoimmilta kohteilta aloittaa hyökkäys? Jos haluat, voit tuoda tulokset metasploit:iin db_import -komennolla.

Tulin lauantaina koululle tekemään, koska asensin kaikki tarvittavat työkalut labraluokan koneelle edellisenä iltana.
En kuitenkaan päässyt luokkaa, joten suoritan tehtävän niillä työkaluilla mitkä saan nopeasti ladattua komentoriviltä.
```
sudo apt-get update  
sudo apt-get install -y nmap
sudo apt-get install -y nikto
sudo apt-get install -y openvas
sudo openvas-setup
```
Skannalin openVAS -asennusta odotellessa pari hackthebox.eu:n kohdetta ensin Nmapilla, saadakseni selville avoimia portteja. Tämän jälkeen skannasin samat kohteet käyttämällä niktoa. Käytin apunani yksinkertaista [ohjetta](https://dynamicparallax.wordpress.com/2017/08/23/nikto-cheat-sheet/), minkä löysin.  
![kuva8](https://i.imgur.com/0m3mR2c.png)

Aloitit tutusta HackTheBoxin kohdekoneesta. Nikto skannaa oletusarvoisesti kohteen porttia 80, joten tein ensimmäisen skannauksen Nmapilla ja tämän jälkeen käytin siitä saatuja tietoja niktolla.  
Komennot olivat `sudo nmap -Pn 10.10.10.95` ja `sudo nikto -h 10.10.10.95:8080`  
Nikton käyttö erosi siinä mielessä, että se ohjasi minua eri suuntaan, kuin mitä kuljin konetta korkatessani metasploitin
skannerin avulla.

Tein tähän asti LiveUsb:llä, mutta koneeni kyykkäsi jossain vaiheessa kesken `openvas-setup` -komennon suorittamisen. Lähdin kotiin jatkamaan kokeilua VirtualBoxilla sijaitsevalla ubuntu 18.04 koneella. Otin Puttyllä etäyhteyden, jotta en joudu tihrustamaan pikkuruista ikkunaa. `Openvas-setup` meni jälleen hieman eri tavalla kuin eilen tehdessäni ensimmäistä tehtävää Kali Linuxilla, enkä saanut asennuksen jälkeen avaimia web-interfaceen kirjautumista varten.  

Käytän tämän tehtävän tekoon Nmap ja Nikto skannereita, kunnes pääsen labraluokkaan, missä openVAS toimii valmiiksi. En halua asentaa omille laitteilleni Kalia ja epäilen että openVAS asennus ei onnistu tämänhetkisellä kokoonpanollani.

Jatketaan siis skannailua tämänhetkisillä välineillä.  
![kuva9](https://i.imgur.com/Ob8YyMr.png)
Skannaukset ehdottavat yhtä tiettyä porttia ja erilaisia haavoittuvuuksia. Tallensin skannauksen tuloksia itseäni varten, mutta en voi niitä julkaista tässä.

Seuraava kohteeni oli 10.10.10.100. Käytin samoja komentoja kuin aiemmin. Sain siis Nmapilla selville joukon portteja joihin kohdistaisin skannaukseni Niktolla. Ensimmäiset 2 porttia eivät paljastaneet mitään tietoa, ja kolmannen skannaukseen kului yli puoli tuntia, joten keskeytin skannauksen ja päätin jatkaa tehtävän tekoa maanantaina, kun pääsen koulun labraluokkaan työskentelemään. Hypätään siis tehtävään 3 ja skannataan vaadittavat kohteet huomenna Niktolla ja openVAS:lla!

**Jatkoa 10.9**  
Valitsin 5 *HackTheBox.Eu*:n maalikonetta ja laitin openVAS:n skannaamaan niitä yhtäaikaa. Kahdesta koneesta openVAS ei löytänyt haavoittuvuuksia, ainakaan vakio parametreillä. Tämän jälkeen hain Nikton avulla lisätietoa koneista.
![70](https://i.imgur.com/VL3u7Yx.png)  
Erona aiempaan oli se, että sain Nikton avulla hyödyllistä tietoa ainakin kahdesta koneesta. Näiden tietojen avulla voin myöhemmin lähteä koittamaan koneisiin murtautumista.
![100](https://i.imgur.com/ErG732u.png)

![102](https://i.imgur.com/BtUHc6f.png)

# Tehtävä 3 #

3) Silmäile Mirai-haittaohjelman lähdekoodia. Etsi lista salasanoista, joita Mirai käyttää. (Tämän kohdan voi tehdä pelkästä lähdekoodista. Mitään ei tarvitse kääntää eikä ajaa. Binäärimuotoiset virukset ja madot voivat levitä, joten niiden käsittely vaatii erityisjärjestelyjä.)

Tavoitteenani on siis tutustua Mirain [lähdekoodiin](https://github.com/jgamblin/Mirai-Source-Code). Kyseessä on haittaohjelma, jonka avulla linuxia käyttäviä laitteita liitetään etähallittavaan bottiverkkoon. Haittaohjelmalla hyödynnetään verkossa olevien laitteiden heikkoja vakio käyttäjätunnus/salasana yhdistelmiä.

[Salasanalistalta](https://github.com/jgamblin/Mirai-Source-Code/blob/master/mirai/bot/scanner.c) löytyi 61 erilaista yhdistelmää, joilla on siis tarkoitus tunkeutua laitteisiin jotka käyttävät tehdasasetuksia.  
![salalistal](https://i.imgur.com/CEPIWOH.png)

Samasta tiedostosta löytyi lisäksi lista eri IP-osoitteista, joihin ohjelman **ei** kuulu koskea.  
![NoTouch](https://i.imgur.com/oVje1nb.png)

Tartutettuaan laitteen, Mirai poistaa muita haittaohjelmia ja estää etäyhteyden ottamisen laitteeseen. Muita haittaohjelmia poistamalla Mirai takaa itselleen enemmän resursseja ja estää muita ohjelmia poistamasta itseään.  
Esimerkiksi SSH:n tappo [koodissa](https://github.com/jgamblin/Mirai-Source-Code/blob/master/mirai/bot/killer.c):  
![SSH](https://i.imgur.com/maonBqC.png)  


# Tehtävä 4 #

4) Yritä korkata joku kone HackTheBoxin verkosta. Maaliin asti ei tarvitse päästä, mutta raportoi mitä kokeilit ja mitä johtolankoja jäi vielä tutkittavaksi.Voit apupyörinä katsoa listasta, mitkä koneet on arvioitu helpoiksi.

Tämä harjoitus jää hyvin lyhyeksi tältä erää, koska kotitehtävien tekoon on mennyt huomattavasti enemmän aikaa kuin luulin, eikä minulla ollut viikonloppuna pääsyä koulun labraluokkaan niin kuin olisin toivonut. Olin aiemmin valinnut seuraavaksi kohteeksi Poisonin (10.10.10.100), mutta se on ilmeisesti vedetty pois aktiivisten kohteiden listalta.  
Toista tehtävää tehdessä sain openVAS:n ja Nikton avulla paljon tietoa kohteesta Hawk, eli 10.10.10.102.  

Nikton viittasi siihen että voin kirjoittaa URL:iin erilaisia osoitteita, joiden ei välttämättä tulisi näkyä kaikille. Esimerkiksi etusivulta `10.10.10.102/INSTALL.mysql.txt` voin siirtyä osoitteeseen `10.10.10.102/web.config`. Sieltä ei välttämättä löydy mitään ratkaisevaa, mutta se voi sisältää uusia vinkkejä. Pyrin jatkamaan hyökkäystä paremmin levänneenä.



