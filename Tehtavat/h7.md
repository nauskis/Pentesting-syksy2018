# h7 #

a) Tee troijalainen Unicornilla ohjeen mukaan. (Vinkki: katso Tatun raporttia)

b) Asenna oma, itsellesi uusi harjoitusmaali. Voit hakea maalikoneen Vulnhubista. Murtaudu koneelle, katso walktroughsta vinkki, jos jäät jumiin.

c) Google Project Zero. Löydätkö tekniikoita, joita voi hyödyntää pentestissä? (Ei tarvitse toistaa haastavia assembler-temppuja)

## Tehtävä a) ##

## Tehtävä b) ##

**Teen tämän harjoituksen ubuntu 18.04 asennuksella**

Valitsin harjoitusmaalin **Basic Pentesting: 2**. En ole hetkeen harjoitellut murtautumista, ja kyseinen kone on kuvauksen mukaan hyvä niille ketkä ovat suorittaneet joitakin helppoja murtoja.  
![kuva3](https://i.imgur.com/rsgfAq0.png)

Asensin virtualboxin, latasin virtuaalikoneen kuvan, siirryin latauskansioon ja purin paketin. asensin koneen Virtualboxissa käyttäen vaihtoehtoa *import appliance*, sen sijaan että olisin luonut uuden koneen niin kuin yleensä.  
```
sudo apt-get install -y virtualbox  
tar -xzf basic_pentesting_2.tar.gz  
virtualbox  
```
![kuva4](https://i.imgur.com/u3lpy1d.png)

Virtuaalikone vaatii muutoksien tekemistä *networking* asetuksiin.

Ensimmäinen haaste kyseisen maalin kohdalla on ilmeisesti se, että sen IP-osoite on tuntematon. En myöskään ole eristettynä muusta verkosta, joten saan olla hyvin varovainen skannauksia tehdessä. Tutkittuani aihetta noin puoli tuntia, hyväksyin, että *virtualbox* ei suoraan luovuta minulle virtuaalikoneen IP-osoitetta, vaan joudun skannaamaan verkkoa. Tässä kohtaa *HackTheBox* ja heidän VPN kuulostavat aika ihanilta. Suoritin nopean skannauksen labraverkossa ja löysin virtuaalikoneen. Jos minulle myöhemmin selviää, että olen erehtynyt kohteesta, lopetan harjoituksen heti.

`sudo netdiscover` 
172.28.171.227  08:00:27:a1:01:12      3     180  PCS Systemtechnik GmbH.  

Tässä vaiheessa tarvitsen Nmapin apua. Skanneri löytyy Kali Linuxista valmiiksi, mutta käytän ubuntu 18.04, joten se täytyy asentaa itse.  
`sudo apt-get install -y nmap`

`sudo nmap -Pn -vv 172.28.171.227`  
Aikaa skannaukseen kului 0.09 sekuntia, joten voisin hyvin uskoa sen olevan oma virtuaalikoneeni.

![kuva7](https://i.imgur.com/PIo3jY7.png)

|Port|state|Service|Reason|
|----|-----|-------|------|
|22/tcp|open|ssh|syn-ack|
|80/tcp|open|http|syn-ack|
|139/tcp|open|netbios-ssn|syn-ack|
|445/tcp|open|microsoft-ds|syn-ack|
|8009/tcp|open|ajp13|syn-ack|
|8080/tcp|open|http-proxy|syn-ack|

Näistä viimeinen näyttää kaikista parhaimmalta vaihtoehdolta. Käydään selaimella osoitteessa  
`http://172.28.171.227:8080`

Olen joskus ennenkin tainnut törmätä tähän näkymään HTB:n yhteydessä.  
![kuva8](https://i.imgur.com/thaHlQp.png)

Googlaan nopeasti Apache Tomcatin oletus käyttäjätunnus/salasana yhdistelmän.
tomcat + s3cret ei päässyt läpi. 

Asennan *Metasploitin*, mutta käytetään sitä vähän myöhemmin. 
```
sudo apt-get install -y curl
curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall && \
  chmod 755 msfinstall && \
  ./msfinstall
```
Tarkistan muut portit selaimella, jos löytäisin lisää hyökkäyspinta-alaa. Osoitteessa `172.28.171.227:80` on avoin sivu, joka on "huollossa". Kaikki muut Nmapin alunperin näyttämät sivut taisivatkin olla kiinni.

![kuva9](https://i.imgur.com/mogZxEb.png)

Asensin OWASP-ZAP:n, sillä muistan käyttäneeni sitä tämänkaltaiseen tiedusteluun aiemminkin.  
Löysin vanhan [asennusohjeeni](https://github.com/nauskis/Pentesting-syksy2018/blob/master/Asennuksia/OWASP_ZAP.md), joten aikaakaan ei kulunut paljoa.  

ZAP ei löytänyt mitään hyödyllistä. Seuraavaksi kokeilen OWASP DirBusteria. Käytin neljännessä [harjoituksessa](https://github.com/nauskis/Pentesting-syksy2018/blob/master/Tehtavat/h4.md) DirBusteria ja kävin sen asennuksen läpi siellä.  
![kuva10](https://i.imgur.com/7cOgsmY.png)  

Hyökkäys on vielä käynnissä ja näyttää jatkuvan 15 minuuttia, mutta sain jo pari hyvää ehdotusta, jotka voin tarkistaa odotellessa.  

![kuva10](https://i.imgur.com/Ctx2hkl.png)

`http://172.28.171.227:80/development` näyttää oikein hyvältä.

dev.txt sisältä:  
![kuva11](https://i.imgur.com/KoEE9mq.png)

Sivulla mainitaan SMB ja versio 2.5.12

j.txt sisältö:  
![kuva12](https://i.imgur.com/ZTW6UNV.png)

Sivulla mainitaan /etc/shadow ja kerrotaan, että J on käyttänyt tai käyttää huonoa salasanaa.

Tutkin erilaisia vaihtoehtoja ja koitin smb skannausta Metasploitin avulla. Tulokset:  
```
[*] 172.28.171.227:445    - Host could not be identified: Windows 6.1 (Samba 4.3.11-Ubuntu)  
[*] Scanned 1 of 1 hosts (100% complete)  
[*] Auxiliary module execution completed  
```

En ole liikkunut mihinkään suuntaan noin tuntiin. Walkthrough:n mukaan olen oikeilla jäljillä, mutta en ole vielä löytänyt työkalua, jolla saisin jotain tietoa irti SMB:stä. Tässä kohtaa tekemistäni haittaa, etten ole Kalilla. 
Olen koittanut saada seuraavat työkalut toimimaan, mutta löydän hyvin vähän ohjeita. Ne olisivat valmiiksi asennettuina Kalilla.  
Smbnmap, Enum4linux.

Virtuaalikoneeseeni voi ottaa yhteyttä labran verkosta, joten laitan toiselle tietokoneelle asentumaan kali linuxin odotellessa. Jos saan tänään illalla edes jotain irti, voin myöhemmin jatkaa siitä mihin jäin helposti.

Sain vihdoin Kalin tulille ja kokeilin enum4linux -työkalua. Komento oli niinkin helppo kuin:  
`enum4linux 172.28.171.227`

Suurin osa sanomasta näytti merkityksettömältä, mutta sain selville kaksi käyttäjätunnusta.  
![kuva13](https://i.imgur.com/Z0RcnZV.png)

*Kay* ja *Jan*. Tarkastelimme aiemmin henkilöiden *J* ja *K* keskustelua. Selvisi, että *J*, eli *Jan*, on käyttänyt heikkoa salasanaa. Tässä vaiheessa voitaisiin siis asentaa *hydra* ja kokeilla *brute-force* -hyökkäystä.  
`sudo apt-get install -y hydra`  

Hydra löytyy Kalilta valmiiksi, mutta se on melkein yhtä nopea asentaa, kuin hypätä toiselle koneelle. Hypätään kuitenkin Kalille, koska muuten meillä ei ole samoja salasanalistoja käytössä.  

Laitin kokeiluun salasanalistat rockyou.txt ja nmap.lst. nmap.lst on melko pieni ja menee vartissa läpi. rockyou.txt taas näyttää olevan sen verta suuri, että minua houkuttelee kurkata vastaus, ellei sitä löydy lyhyiltä listoilta. Näin voisin säästää tunteja aikaa.

Jatkan ensi kerralla tästä. Labraluokka menee ennenpitkää kiinni, enkä jaksa välttämättä käydä läpi uusia salasanalistoja vielä.  
Käyttäjätunnus: jan  
salasana:       ??

### Jatkoa viime kerrasta ###  
Luulin kokeilleeni viimeksi *nmap.lst* -salasanalistaa, mutta löysin salasanan kyseiseltä listalta tänään.

![kuva14](https://i.imgur.com/xw4OA35.png)

Käyttäjätunnus: jan  
salasana: armando  

![kuva15](https://i.imgur.com/isMVODK.png)

Seuraavaksi täytyy keksiä keino saada paremmat oikeudet ja löytää lippu.

Tatun vinkki SMB enumerointiin:  
https://github.com/m8r0wn/nullinux



## Tehtävä c) ##
